class R{static async scaleToDataURL(d,u,w,g,s){const c=await h(d,u);try{const{width:t,height:e}=c;if(t===0||e===0)throw new Error("Decoded image has zero dimensions.");const n=Math.min(w/t,g/e),a=Math.max(1,Math.round(t*n)),r=Math.max(1,Math.round(e*n)),{canvas:i,ctx:o}=f(a,r);return o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.clearRect(0,0,a,r),o.drawImage(c,0,0,a,r),await y(i)}finally{try{typeof c.close=="function"&&c.close()}catch{}}async function h(t,e){const n=new Blob([t],{type:e});return typeof createImageBitmap=="function"?await createImageBitmap(n):await new Promise((a,r)=>{const i=URL.createObjectURL(n),o=new Image;o.onload=async()=>{try{const{canvas:m,ctx:B}=f(o.naturalWidth,o.naturalHeight);B.drawImage(o,0,0),URL.revokeObjectURL(i);const x=await b(m);a(x)}catch(m){r(m)}},o.onerror=()=>{URL.revokeObjectURL(i),r(new Error("Failed to decode image."))},o.src=i})}function f(t,e){if(typeof OffscreenCanvas<"u"){const r=new OffscreenCanvas(t,e),i=r.getContext("2d");if(!i)throw new Error("Could not get 2D context.");return{canvas:r,ctx:i}}const n=document.createElement("canvas");n.width=t,n.height=e;const a=n.getContext("2d");if(!a)throw new Error("Could not get 2D context.");return{canvas:n,ctx:a}}async function b(t){if("transferToImageBitmap"in t&&typeof t.transferToImageBitmap=="function")return t.transferToImageBitmap();const e=await l(t);return await createImageBitmap(e)}async function l(t){return"convertToBlob"in t&&typeof t.convertToBlob=="function"?await t.convertToBlob({type:`image/${s}`}):await new Promise((e,n)=>{t.toBlob(a=>{if(!a){n(new Error("Canvas toBlob failed."));return}e(a)},`image/${s}`)})}async function y(t){if(typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement)return t.toDataURL(`image/${s}`);const e=await l(t);return await p(e)}function p(t){return new Promise((e,n)=>{const a=new FileReader;a.onload=()=>e(String(a.result)),a.onerror=()=>n(new Error("Failed to read blob as data URL.")),a.readAsDataURL(t)})}}}export{R as ImageUtils};
