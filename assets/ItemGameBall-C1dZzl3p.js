import{d as h,g as n}from"./index-D_-3yara.js";class l{constructor(e){this.item=e}angleSpread=.5;containers=[];balls=[];x=0;y=0;prevX=0;prevY=0;angle=0;lastTime=0;running=!1;rafId=null;resizeObserver=null;removalObserver=null;get speed(){return this.item.settings.speed}get ballSize(){return this.item.settings.itemSize}start(e){if(e.length===0)throw new Error("At least one container is required");this.stop(),this.containers=e,this.container=e[0],this.balls=e.map(i=>{const t=document.createElement("div");return i.style.position||="relative",t.style.position="absolute",t.style.width=`${this.ballSize}px`,t.style.height=`${this.ballSize}px`,t.style.borderRadius="50%",t.style.backgroundColor=n.textColor,t.style.left="0",t.style.top="0",t.style.transform="translate3d(0, 0, 0)",t.style.willChange="transform",i.appendChild(t),t}),this.handleResize(),this.observeResize(),this.observeRemoval();const s=this.container;this.x=s.clientWidth/2,this.y=s.clientHeight/2,this.prevX=this.x,this.prevY=this.y,this.angle=Math.random()*Math.PI*2,this.running=!0,this.lastTime=performance.now(),this.loop(this.lastTime)}pause(){this.running=!this.running,this.running&&this.rafId===null&&(this.lastTime=performance.now(),this.loop(this.lastTime))}stop(){this.running=!1,this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.resizeObserver?.disconnect(),this.removalObserver?.disconnect(),this.resizeObserver=null,this.removalObserver=null;for(const e of this.balls)e.remove();this.containers=[],this.balls=[],this.x=0,this.y=0,this.prevX=0,this.prevY=0,this.angle=0,this.lastTime=0}loop=e=>{if(!this.running){this.rafId=null;return}const s=(e-this.lastTime)/1e3;this.lastTime=e,this.update(s),this.draw(),this.rafId=requestAnimationFrame(this.loop)};update(e){const s=this.container,i=this.ballSize/2;this.prevX=this.x,this.prevY=this.y,this.x+=Math.cos(this.angle)*this.speed*e,this.y+=Math.sin(this.angle)*this.speed*e;let t=!1;this.x-i<0?(this.x=i,this.angle=Math.PI-this.angle,t=!0):this.x+i>s.clientWidth&&(this.x=s.clientWidth-i,this.angle=Math.PI-this.angle,t=!0),this.y-i<0?(this.y=i,this.angle=-this.angle,t=!0):this.y+i>s.clientHeight&&(this.y=s.clientHeight-i,this.angle=-this.angle,t=!0),t&&(this.angle+=this.angleSpread*Math.random())}draw(){const e=this.x-this.ballSize/2,s=this.y-this.ballSize/2,i=`translate3d(${e}px, ${s}px, 0)`;for(const t of this.balls)t.style.transform=i,t.style.width=`${this.ballSize}px`,t.style.height=`${this.ballSize}px`}handleResize(){const e=this.container.getBoundingClientRect(),s=this.ballSize/2;this.x=Math.min(Math.max(this.x,s),e.width-s),this.y=Math.min(Math.max(this.y,s),e.height-s),this.prevX=this.x,this.prevY=this.y}observeResize(){this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.container)}observeRemoval(){const e=this.container.parentNode;e&&(this.removalObserver=new MutationObserver(s=>{for(const i of s)for(const t of i.removedNodes)if(t===this.container){this.stop();return}}),this.removalObserver.observe(e,{childList:!0}))}}class o extends h{onOpen(){setTimeout(()=>{new l(this).start([...document.querySelectorAll(".reader .playground")])})}}export{o as ItemGameBall,o as default};
