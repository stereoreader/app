import{s as R}from"./index-5VpD7k4q.js";import{I as $}from"./ItemGame-C3ToN1ql.js";const f=["#F7BABA","#F7F7BA","#BDF3BD","#BDF3F3","#C9C9F7","#F5CAF5"],Y=.035;class B{angleSpread=.5;perspectiveAngle=25;containers=[];cubes=[];x=0;y=0;angle=0;rotX=0;rotY=0;rotZ=0;rotateSpeedX=0;rotateSpeedY=0;rotateSpeedZ=0;lastTime=0;running=!1;rafId=null;resizeObserver=null;removalObserver=null;get speed(){return this.container.clientHeight*.73529411764}get cubeSize(){return R.fontSize}start(t){if(t.length!==2)throw new Error("Exactly two containers required for stereo view");this.stop(),this.containers=t,this.container=t[0],this.cubes=t.map(e=>{e.style.position||="relative",this.applyPerspective(e);const s=this.createCube(this.cubeSize);return e.appendChild(s),s}),this.handleResize(),this.observeResize(),this.observeRemoval(),this.x=this.container.clientWidth/2,this.y=this.container.clientHeight/2,this.angle=Math.random()*Math.PI*2,this.randomizeRotation(),this.running=!0,this.lastTime=performance.now(),this.loop(this.lastTime)}pause(){this.running=!this.running,this.running&&this.rafId===null&&(this.lastTime=performance.now(),this.loop(this.lastTime))}createCube(t){const e=document.createElement("div");return e.style.position="absolute",e.style.transformStyle="preserve-3d",e.style.willChange="transform",e.style.left="0",e.style.top="0",e.style.transformOrigin="50% 50% 0",this.updateCubeGeometry(e,t),e}updateCubeGeometry(t,e){t.style.width=`${e}px`,t.style.height=`${e}px`,t.replaceChildren();const s=e/2,n=[{color:f[0],transform:`translateZ(${s}px)`},{color:f[1],transform:`rotateY(180deg) translateZ(${s}px)`},{color:f[2],transform:`rotateY(90deg) translateZ(${s}px)`},{color:f[3],transform:`rotateY(-90deg) translateZ(${s}px)`},{color:f[4],transform:`rotateX(90deg) translateZ(${s}px)`},{color:f[5],transform:`rotateX(-90deg) translateZ(${s}px)`}];for(const r of n){const i=document.createElement("div");i.style.position="absolute",i.style.inset="0",i.style.backgroundColor=r.color,i.style.opacity="0.95",i.style.backfaceVisibility="hidden",i.style.transform=r.transform,i.style.border=".5px solid black",t.appendChild(i)}}applyPerspective(t){const e=Math.max(0,this.perspectiveAngle);if(e===0){t.style.perspective="",t.style.perspectiveOrigin="";return}const s=this.perspectivePxForAngle(t,e);t.style.perspective=`${s}px`,t.style.perspectiveOrigin="50% 50%"}perspectivePxForAngle(t,e){const n=e*Math.PI/180/2,r=t.clientWidth,i=t.clientHeight,a=Math.max(1,Math.min(r,i)),o=Math.tan(n);return!Number.isFinite(o)||o<=0?1e6:a/2/o}getPerspectivePx(){const t=Math.max(0,this.perspectiveAngle);return t===0?Number.POSITIVE_INFINITY:this.perspectivePxForAngle(this.container,t)}randomizeRotation(){this.rotateSpeedX=(Math.random()-.5)*2.5,this.rotateSpeedY=(Math.random()-.5)*2.5,this.rotateSpeedZ=(Math.random()-.5)*2.5}stop(){this.running=!1,this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.resizeObserver?.disconnect(),this.removalObserver?.disconnect(),this.resizeObserver=null,this.removalObserver=null;for(const t of this.cubes)t.remove();this.containers=[],this.cubes=[],this.x=0,this.y=0,this.angle=0,this.rotX=0,this.rotY=0,this.rotZ=0,this.rotateSpeedX=0,this.rotateSpeedY=0,this.rotateSpeedZ=0,this.lastTime=0}loop=t=>{if(!this.running){this.rafId=null;return}const e=(t-this.lastTime)/1e3;this.lastTime=t,this.update(e),this.draw(),this.rafId=requestAnimationFrame(this.loop)};update(t){const e=this.cubeSize,s=this.container.clientWidth,n=this.container.clientHeight,r=Math.cos(this.angle)*this.speed,i=Math.sin(this.angle)*this.speed,a=this.x+r*t,o=this.y+i*t,c=this.rotX+this.rotateSpeedX*t,l=this.rotY+this.rotateSpeedY*t,m=this.rotZ+this.rotateSpeedZ*t,h=this.projectedExtentsForBothEyes(e,c,l,m);let p=a,d=o,u=!1;const x=-h.minX,g=s-h.maxX;p<x?(p=x,this.angle=Math.PI-this.angle,u=!0):p>g&&(p=g,this.angle=Math.PI-this.angle,u=!0);const y=-h.minY,v=n-h.maxY;d<y?(d=y,this.angle=-this.angle,u=!0):d>v&&(d=v,this.angle=-this.angle,u=!0),u&&(this.angle+=this.angleSpread*Math.random(),this.randomizeRotation()),this.x=p,this.y=d,this.rotX=c,this.rotY=l,this.rotZ=m}draw(){const t=this.cubeSize,e=this.x-t/2,s=this.y-t/2;for(let n=0;n<this.cubes.length;n++){const r=this.cubes[n];r.offsetWidth!==t&&this.updateCubeGeometry(r,t),this.applyPerspective(this.containers[n]);const i=n===0?-Y:Y;r.style.transform=`translate3d(${e}px, ${s}px, 0)
                 rotateX(${this.rotX}rad)
                 rotateY(${this.rotY+i}rad)
                 rotateZ(${this.rotZ}rad)`}}projectedExtentsForBothEyes(t,e,s,n){const r=this.projectedExtents(t,e,s-Y,n),i=this.projectedExtents(t,e,s+Y,n);return{minX:Math.min(r.minX,i.minX),maxX:Math.max(r.maxX,i.maxX),minY:Math.min(r.minY,i.minY),maxY:Math.max(r.maxY,i.maxY)}}projectedExtents(t,e,s,n){const r=t/2,i=this.getPerspectivePx(),a=Math.cos(e),o=Math.sin(e),c=Math.cos(s),l=Math.sin(s),m=Math.cos(n),h=Math.sin(n),p=c*m,d=-c*h,u=l,x=o*l*m+a*h,g=-o*l*h+a*m,y=-o*c,v=-a*l*m+o*h,P=a*l*h+o*m,T=a*c;let M=Number.POSITIVE_INFINITY,X=Number.NEGATIVE_INFINITY,F=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY;for(const z of[-r,r])for(const C of[-r,r])for(const N of[-r,r]){const w=p*z+d*C+u*N,A=x*z+g*C+y*N,Z=v*z+P*C+T*N,E=Number.isFinite(i)?i/(i-Z):1,b=w*E,I=A*E;b<M&&(M=b),b>X&&(X=b),I<F&&(F=I),I>S&&(S=I)}return{minX:M,maxX:X,minY:F,maxY:S}}handleResize(){for(const c of this.containers)this.applyPerspective(c);const t=this.container.clientWidth,e=this.container.clientHeight,s=this.cubeSize,n=this.projectedExtentsForBothEyes(s,this.rotX,this.rotY,this.rotZ),r=-n.minX,i=t-n.maxX,a=-n.minY,o=e-n.maxY;this.x=Math.min(Math.max(this.x,r),i),this.y=Math.min(Math.max(this.y,a),o)}observeResize(){this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.container)}observeRemoval(){const t=this.container.parentNode;t&&(this.removalObserver=new MutationObserver(e=>{for(const s of e)for(const n of s.removedNodes)if(n===this.container){this.stop();return}}),this.removalObserver.observe(t,{childList:!0}))}}class V extends ${onOpen(){setTimeout(()=>{new B().start([...document.querySelectorAll(".reader .playground")])})}}export{V as ItemGameCube,V as default};
