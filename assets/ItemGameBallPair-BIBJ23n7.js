import{d as p,g as n,W as c,s as h}from"./App-CXLwFnP_.js";import{m as a,R as g}from"./index-BkzqfRJK.js";class d{constructor(t){this.item=t}angleSpread=.5;container;balls=null;x=0;y=0;prevX=0;prevY=0;angle=0;lastTime=0;running=!1;rafId=null;resizeObserver=null;speedMultiplier=1;reflectionTime=0;currentAccelerationMultiplier=0;get gap(){return n.gapUnit==="pixels"?h.gap:Math.round(window.innerWidth*h.gap/100)}get ballSize(){return this.item.settings.itemSize}get radius(){return this.ballSize/2}get groupHalfWidth(){return this.gap/2+this.radius}get speed(){return this.item.settings.speed*this.speedMultiplier}start(t){this.stop(),this.container=t,this.container.style.position||="relative";const e=()=>{const s=document.createElement("div");return s.style.position="absolute",s.style.width=`${this.ballSize}px`,s.style.height=`${this.ballSize}px`,s.style.borderRadius="50%",s.style.left="0",s.style.top="0",s.style.willChange="transform",s},r=e(),i=e();this.container.appendChild(r),this.container.appendChild(i),this.balls=[r,i],this.handleResize(),this.observeResize(),this.x=this.container.clientWidth/2,this.y=this.container.clientHeight/2,this.prevX=this.x,this.prevY=this.y,this.angle=Math.random()*Math.PI*2,this.running=!0,this.lastTime=performance.now(),this.loop(this.lastTime)}pause(){this.running=!this.running,this.running&&this.rafId===null&&(this.lastTime=performance.now(),this.loop(this.lastTime))}stop(){this.running=!1,this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.resizeObserver?.disconnect(),this.resizeObserver=null,this.balls&&(this.balls[0].remove(),this.balls[1].remove()),this.balls=null,this.x=0,this.y=0,this.prevX=0,this.prevY=0,this.angle=0,this.lastTime=0}loop=t=>{if(!this.running){this.rafId=null;return}const e=(t-this.lastTime)/1e3;this.lastTime=t,this.update(e),this.draw(),this.rafId=requestAnimationFrame(this.loop)};update(t){const e=this.radius;this.reflectionTime+=t,this.prevX=this.x,this.prevY=this.y;const r=Math.pow(1+this.currentAccelerationMultiplier,this.reflectionTime);this.x+=Math.cos(this.angle)*this.speed*r*t,this.y+=Math.sin(this.angle)*this.speed*r*t;let i=!1;if(this.x-this.groupHalfWidth<0?(this.x=this.groupHalfWidth,this.angle=Math.PI-this.angle,i=!0):this.x+this.groupHalfWidth>this.container.clientWidth&&(this.x=this.container.clientWidth-this.groupHalfWidth,this.angle=Math.PI-this.angle,i=!0),this.y-e<0?(this.y=e,this.angle=-this.angle,i=!0):this.y+e>this.container.clientHeight&&(this.y=this.container.clientHeight-e,this.angle=-this.angle,i=!0),i){this.speedMultiplier=1+(Math.random()*this.item.settings.reflectionSpeedSpread*2-this.item.settings.reflectionSpeedSpread),this.reflectionTime=0;const{reflectionAccelerationMin:s,reflectionAccelerationMax:o}=this.item.settings;this.currentAccelerationMultiplier=s+Math.random()*(o-s),this.angle+=this.angleSpread*Math.random()}}draw(){if(!this.balls)return;const t=this.y-this.radius,e=this.x-this.gap/2,r=this.x+this.gap/2;this.balls[0].style.transform=`translate3d(${e-this.radius}px, ${t}px, 0)`,this.balls[1].style.transform=`translate3d(${r-this.radius}px, ${t}px, 0)`;for(const i of this.balls)i.style.width=`${this.ballSize}px`,i.style.height=`${this.ballSize}px`,i.style.backdropFilter=`brightness(${this.item.settings.itemBrightness*100}%)`,i.style.backgroundColor=`color-mix(in srgb, ${n.textColor} ${this.item.settings.itemColorOpacity*100}%, transparent)`}handleResize(){const t=this.container.getBoundingClientRect(),e=this.radius;this.x=Math.min(Math.max(this.x,this.groupHalfWidth),t.width-this.groupHalfWidth),this.y=Math.min(Math.max(this.y,e),t.height-e),this.prevX=this.x,this.prevY=this.y}observeResize(){this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.container)}}class f extends p{get settingsToOverride(){return{...super.settingsToOverride,noStereo:!0}}constructor(){super(),this.settings.reflectionSpeedSpread=0,this.settings.reflectionAccelerationMin=0,this.settings.reflectionAccelerationMax=0,this.settings.reflectionAccelerationAddSpeedSpread=!1,this.settings.gap=100,this.settings.gapUnit="pixels",this.settings.itemBrightness=3,this.settings.itemBlur=0,this.settings.itemColorOpacity=0}get settingsToShow(){return["gap"]}component=(t,e)=>n.textWallpaper?[]:[a(g,{to:"body"},[a(c)])];onOpen(){setTimeout(()=>{this.game=new d(this),this.game.start([...document.querySelectorAll(".reader .playground")][0])})}onClose(){this.game?.stop()}}export{f as ItemGameBallPair,f as default};
