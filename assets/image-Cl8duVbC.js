class b{static decodeBase64ToBytes(o){o=o.replace(/\s+/g,"");const s=o.length;if(s%4!==0)throw new Error("Invalid base64 length");let w=0;s>=2&&o[s-1]==="="&&w++,s>=2&&o[s-2]==="="&&w++;const d=s/4*3-w,m=new Uint8Array(d);let u=0;for(let e=0;e<s;e+=4){const h=f(o.charCodeAt(e)),y=f(o.charCodeAt(e+1)),p=f(o.charCodeAt(e+2)),B=f(o.charCodeAt(e+3)),t=h<<18|y<<12|p<<6|B;u<d&&(m[u++]=t>>16&255),u<d&&(m[u++]=t>>8&255),u<d&&(m[u++]=t&255)}return m;function f(e){if(e>=65&&e<=90)return e-65;if(e>=97&&e<=122)return e-97+26;if(e>=48&&e<=57)return e-48+52;if(e===43)return 62;if(e===47)return 63;if(e===61)return 0;throw new Error("Invalid base64 character")}}static async scaleToDataURL(o,s,w,d,m,u){const f=await e(o,s);try{const{width:t,height:a}=f;if(t===0||a===0)throw new Error("Decoded image has zero dimensions.");const r=Math.min(w/t,d/a),n=Math.max(1,Math.round(t*r)),l=Math.max(1,Math.round(a*r)),{canvas:c,ctx:i}=h(n,l);if(i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.clearRect(0,0,n,l),i.drawImage(f,0,0,u?.half?t/2:t,a,0,0,n,l),typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement)return c.toDataURL(`image/${m}`);const g=await p(c);return await B(g)}finally{try{typeof f.close=="function"&&f.close()}catch{}}async function e(t,a){const r=t instanceof Blob?t:new Blob([t],{type:a});return typeof createImageBitmap=="function"?await createImageBitmap(r):await new Promise((n,l)=>{const c=URL.createObjectURL(r),i=new Image;i.onload=async()=>{try{const{canvas:g,ctx:C}=h(i.naturalWidth,i.naturalHeight);C.drawImage(i,0,0),URL.revokeObjectURL(c);const v=await y(g);n(v)}catch(g){l(g)}},i.onerror=()=>{URL.revokeObjectURL(c),l(new Error("Failed to decode image."))},i.src=c})}function h(t,a){if(typeof OffscreenCanvas<"u"){const l=new OffscreenCanvas(t,a),c=l.getContext("2d");if(!c)throw new Error("Could not get 2D context.");return{canvas:l,ctx:c}}const r=document.createElement("canvas");r.width=t,r.height=a;const n=r.getContext("2d");if(!n)throw new Error("Could not get 2D context.");return{canvas:r,ctx:n}}async function y(t){if("transferToImageBitmap"in t&&typeof t.transferToImageBitmap=="function")return t.transferToImageBitmap();const a=await p(t);return await createImageBitmap(a)}async function p(t){return"convertToBlob"in t&&typeof t.convertToBlob=="function"?await t.convertToBlob({type:`image/${m}`}):await new Promise((a,r)=>{t.toBlob(n=>{if(!n){r(new Error("Canvas toBlob failed."));return}a(n)},`image/${m}`)})}function B(t){return new Promise((a,r)=>{const n=new FileReader;n.onload=()=>a(String(n.result)),n.onerror=()=>r(new Error("Failed to read blob as data URL.")),n.readAsDataURL(t)})}}}export{b as ImageUtils};
