import{s as r,g as n}from"./index-XjOfz5Dg.js";import{I as a}from"./ItemGame-B1-2KE2b.js";class l{constructor(t){this.item=t}angleSpread=.5;container;balls=null;x=0;y=0;prevX=0;prevY=0;angle=0;lastTime=0;running=!1;rafId=null;resizeObserver=null;removalObserver=null;get gap(){return r.gap}get ballSize(){return r.fontSize}get radius(){return this.ballSize/2}get groupHalfWidth(){return this.gap/2+this.radius}get speed(){return this.item.settings.speed}start(t){this.stop(),this.container=t,this.container.style.position||="relative";const e=this.createBall(),s=this.createBall();this.container.appendChild(e),this.container.appendChild(s),this.balls=[e,s],this.handleResize(),this.observeResize(),this.observeRemoval(),this.x=this.container.clientWidth/2,this.y=this.container.clientHeight/2,this.prevX=this.x,this.prevY=this.y,this.angle=Math.random()*Math.PI*2,this.running=!0,this.lastTime=performance.now(),this.loop(this.lastTime)}pause(){this.running=!this.running,this.running&&this.rafId===null&&(this.lastTime=performance.now(),this.loop(this.lastTime))}stop(){this.running=!1,this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.resizeObserver?.disconnect(),this.removalObserver?.disconnect(),this.resizeObserver=null,this.removalObserver=null,this.balls&&(this.balls[0].remove(),this.balls[1].remove()),this.balls=null,this.x=0,this.y=0,this.prevX=0,this.prevY=0,this.angle=0,this.lastTime=0}loop=t=>{if(!this.running){this.rafId=null;return}const e=(t-this.lastTime)/1e3;this.lastTime=t,this.update(e),this.draw(),this.rafId=requestAnimationFrame(this.loop)};update(t){const e=this.radius;this.prevX=this.x,this.prevY=this.y,this.x+=Math.cos(this.angle)*this.speed*t,this.y+=Math.sin(this.angle)*this.speed*t;let s=!1;this.x-this.groupHalfWidth<0?(this.x=this.groupHalfWidth,this.angle=Math.PI-this.angle,s=!0):this.x+this.groupHalfWidth>this.container.clientWidth&&(this.x=this.container.clientWidth-this.groupHalfWidth,this.angle=Math.PI-this.angle,s=!0),this.y-e<0?(this.y=e,this.angle=-this.angle,s=!0):this.y+e>this.container.clientHeight&&(this.y=this.container.clientHeight-e,this.angle=-this.angle,s=!0),s&&(this.angle+=this.angleSpread*Math.random())}draw(){if(!this.balls)return;const t=this.y-this.radius,e=this.x-this.gap/2,s=this.x+this.gap/2;this.balls[0].style.transform=`translate3d(${e-this.radius}px, ${t}px, 0)`,this.balls[1].style.transform=`translate3d(${s-this.radius}px, ${t}px, 0)`;for(const i of this.balls)i.style.width=`${this.ballSize}px`,i.style.height=`${this.ballSize}px`}handleResize(){const t=this.container.getBoundingClientRect(),e=this.radius;this.x=Math.min(Math.max(this.x,this.groupHalfWidth),t.width-this.groupHalfWidth),this.y=Math.min(Math.max(this.y,e),t.height-e),this.prevX=this.x,this.prevY=this.y}observeResize(){this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.container)}observeRemoval(){const t=this.container.parentNode;t&&(this.removalObserver=new MutationObserver(e=>{for(const s of e)for(const i of s.removedNodes)if(i===this.container){this.stop();return}}),this.removalObserver.observe(t,{childList:!0}))}createBall(){const t=document.createElement("div");return t.style.position="absolute",t.style.width=`${this.ballSize}px`,t.style.height=`${this.ballSize}px`,t.style.borderRadius="50%",t.style.backgroundColor=n.textColor,t.style.left="0",t.style.top="0",t.style.willChange="transform",t}}class u extends a{get settingsToOverride(){return{...super.settingsToOverride,noStereo:!0}}get settingsToShow(){return["gap"]}get settingsToStore(){return["width","gap","fontSize"]}onOpen(){this.settings.gap??=100,setTimeout(()=>{new l(this).start([...document.querySelectorAll(".reader .playground")][0])})}}export{u as ItemGameBallPair,u as default};
