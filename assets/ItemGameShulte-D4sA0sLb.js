import{d as f,w as h,s as a,g as c}from"./index-B7WQUzcY.js";class d{constructor(e){this.item=e}containers=[];numbers=[];resizeObserver=null;removalObserver=null;off=[];get fontSize(){return a.fontSize}get textColor(){return c.textColor}get size(){return this.item.settings.size}start(e){if(e.length===0)throw new Error("At least one container is required");this.stop(),this.containers=e,this.observeResize(),this.observeRemoval(),this.next()}next(){this.generateNumbers(),this.render()}stop(){this.resizeObserver?.disconnect(),this.removalObserver?.disconnect(),this.resizeObserver=null,this.removalObserver=null;for(const e of this.containers)e.innerHTML="";this.containers=[],this.numbers=[],this.off.forEach(e=>e())}generateNumbers(){const e=this.size*this.size;this.numbers=Array.from({length:e},(s,r)=>r+1);for(let s=e-1;s>0;s-=1){const r=Math.floor(Math.random()*(s+1)),o=this.numbers[s];this.numbers[s]=this.numbers[r],this.numbers[r]=o}}render(){const s=this.containers[0].getBoundingClientRect(),r=s.width/this.size,o=s.height/this.size;for(const n of this.containers){n.innerHTML="";for(let i=0;i<this.numbers.length;i+=1){const u=Math.floor(i/this.size),b=i%this.size,t=document.createElement("div");t.textContent=String(this.numbers[i]),t.style.position="absolute",t.style.left=`${b*r}px`,t.style.top=`${u*o}px`,t.style.width=`${r}px`,t.style.height=`${o}px`,t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.boxSizing="border-box";const l=`1px solid color-mix(in srgb, ${this.textColor} 50%, transparent)`;i%this.size||(t.style.borderLeft=l),i<this.size&&(t.style.borderTop=l),t.style.borderRight=t.style.borderBottom=l,t.style.color=this.textColor,t.style.fontSize=`${this.fontSize}px`,t.style.lineHeight=`${this.fontSize}px`,t.style.overflow="hidden",t.style.whiteSpace="nowrap",n.appendChild(t)}}}observeResize(){const e=this.containers[0];this.resizeObserver=new ResizeObserver(()=>{this.render()}),this.resizeObserver.observe(e)}observeRemoval(){const e=this.containers[0],s=e.parentNode;s&&(this.removalObserver=new MutationObserver(r=>{for(const o of r)for(const n of o.removedNodes)if(n===e){this.stop();return}}),this.removalObserver.observe(s,{childList:!0}))}}class g extends f{supports(e){return e==="fontSize"?!0:super.supports(e)}constructor(){super();const e=["game"];for(const s of e)Object.defineProperty(this,s,{writable:!0,configurable:!1,enumerable:!1,value:this[s]});this.settings.size??=5}onOpen(){setTimeout(()=>{this.settings.size??=5,this.game=new d(this),this.game.start([...document.querySelectorAll(".reader .playground")]),h(()=>this.settings.size,e=>this.game?.next(),{immediate:!0}),h([()=>a.fontSize,()=>c.textColor],()=>this.game.render())})}next(){this.game?.next()}}export{g as ItemGameShulte,g as default};
