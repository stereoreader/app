class L{static async scaleToDataURL(f,w,g,u,m,h){const s=await b(f,w);try{const{width:t,height:a}=s;if(t===0||a===0)throw new Error("Decoded image has zero dimensions.");const n=Math.min(g/t,u/a),e=Math.max(1,Math.round(t*n)),i=Math.max(1,Math.round(a*n)),{canvas:r,ctx:o}=l(e,i);if(o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.clearRect(0,0,e,i),o.drawImage(s,0,0,h?.half?t/2:t,a,0,0,e,i),typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement)return r.toDataURL(`image/${m}`);const c=await d(r);return await p(c)}finally{try{typeof s.close=="function"&&s.close()}catch{}}async function b(t,a){const n=t instanceof Blob?t:new Blob([t],{type:a});return typeof createImageBitmap=="function"?await createImageBitmap(n):await new Promise((e,i)=>{const r=URL.createObjectURL(n),o=new Image;o.onload=async()=>{try{const{canvas:c,ctx:B}=l(o.naturalWidth,o.naturalHeight);B.drawImage(o,0,0),URL.revokeObjectURL(r);const v=await y(c);e(v)}catch(c){i(c)}},o.onerror=()=>{URL.revokeObjectURL(r),i(new Error("Failed to decode image."))},o.src=r})}function l(t,a){if(typeof OffscreenCanvas<"u"){const i=new OffscreenCanvas(t,a),r=i.getContext("2d");if(!r)throw new Error("Could not get 2D context.");return{canvas:i,ctx:r}}const n=document.createElement("canvas");n.width=t,n.height=a;const e=n.getContext("2d");if(!e)throw new Error("Could not get 2D context.");return{canvas:n,ctx:e}}async function y(t){if("transferToImageBitmap"in t&&typeof t.transferToImageBitmap=="function")return t.transferToImageBitmap();const a=await d(t);return await createImageBitmap(a)}async function d(t){return"convertToBlob"in t&&typeof t.convertToBlob=="function"?await t.convertToBlob({type:`image/${m}`}):await new Promise((a,n)=>{t.toBlob(e=>{if(!e){n(new Error("Canvas toBlob failed."));return}a(e)},`image/${m}`)})}function p(t){return new Promise((a,n)=>{const e=new FileReader;e.onload=()=>a(String(e.result)),e.onerror=()=>n(new Error("Failed to read blob as data URL.")),e.readAsDataURL(t)})}}}export{L as ImageUtils};
